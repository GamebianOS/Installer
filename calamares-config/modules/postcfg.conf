---
script:
  # Set up Steam autostart
  - ["chroot", "/target", "systemctl", "enable", "sddm"]
  - ["chroot", "/target", "systemctl", "enable", "NetworkManager"]
  - ["chroot", "/target", "systemctl", "enable", "ssh"]
  - ["chroot", "/target", "systemctl", "enable", "bluetooth"]
  
  # Configure SDDM for Steam-first
  - ["cp", "/run/live/medium/live/sddm-steam.conf", "/target/etc/sddm.conf.d/"]
  
  # Create steam user directory
  - ["mkdir", "-p", "/target/home/gamebian/.steam/steam/steamapps/common"]
  - ["chown", "-R", "gamebian:gamebian", "/target/home/gamebian/.steam"]
  
  # Set up MangoHud
  - ["mkdir", "-p", "/target/home/gamebian/.config/MangoHud"]
  - ["cp", "/run/live/medium/live/mangohud.conf", "/target/home/gamebian/.config/MangoHud/"]
  
  # Install 32-bit libraries
  - ["chroot", "/target", "dpkg", "--add-architecture", "i386"]
  - ["chroot", "/target", "apt", "update"]
  - ["chroot", "/target", "apt", "install", "-y", "libgl1-mesa-dri:i386", "mesa-vulkan-drivers:i386"]
  
  # Remove live system packages
  - ["chroot", "/target", "apt", "remove", "-y", "calamares", "calamares-settings-debian"]
  - ["chroot", "/target", "apt", "autoremove", "-y"]
  - ["chroot", "/target", "apt", "clean"]
  
  # Update initramfs
  - ["chroot", "/target", "update-initramfs", "-u"]
  
  # Create first-run flag
  - ["touch", "/target/etc/gamebian/first-run"]
